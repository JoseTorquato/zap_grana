{% extends 'layout/no-side-bar.html' %}

{% block title %} Agenda {% endblock %}

{% load i18n %}

{% load static %}

{% block content %}


<div class="dm-page-content">
    <div class="container-fluid">
        <div class="row calendar-grid justify-content-center">
            <div class="col-md-12">
                <div class="d-flex justify-content-end align-items-center mb-2">
                    <label for="customDateField" class="me-2">Pesquisar: </label>
                    <div class="col-md-2">
                        <input type="date" class="form-control" id="customDateField">
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="card card-default card-md mb-4">
                        <div class="card-body">
                            <div id='calendario'></div>
                            <div class="dm-badge-text d-inline">
                                <span class="badge-dot dot-warning me-1"></span>
                                <span>Pré Reserva</span>
                            </div>
                            <div class="ms-2 dm-badge-text d-inline">
                                <span class="badge-dot dot-danger me-1"></span>
                                <span>Ocupado</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<input type="hidden" id="reservados" value="{{ reservados }}">
<input type="hidden" id="ocupados" value="{{ ocupados }}">

<script src="{% static 'js/plugins/fullcalendar@5.2.0.js' %}"></script>
<script src="{% static 'js/plugins/moment.js' %}"></script>

<script>
    const reservados = document.getElementById("reservados").value
    const ocupados = document.getElementById("ocupados").value

    let reservado = {
        id: 1,
        events: JSON.parse(reservados),
        className: "red",
        textColor: "#FFF",
      };
      
      let ocupado = {
        id: 4,
        events: JSON.parse(ocupados),
        className: "warning",
        textColor: "#FFF",
      };
    
    document.addEventListener('DOMContentLoaded', function () {
        var calendarEl = document.getElementById('calendario');
        var today = document.getElementsByClassName('fc-today-button');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            locale: 'pt-br',
            customButtons: {
                Search: {
                  text: 'Buscar',
                  click: function() {
                    const dataSelecionada = document.getElementById('customDateField').value;
            
                    if (dataSelecionada) {
                        calendar.gotoDate(dataSelecionada);
                    }
                  }
                },
              },
            headerToolbar: {
                left: "prev,today,next",
                center: "title",
                right: "Search",
            },
            buttonText: {
                today: "Hoje",
            },
            listDayFormat: true,
            listDayAltFormat: true,
            allDaySlot: false,
            editable: true,
            contentHeight: 600,
            initialView: "dayGridMonth",
            eventSources: [reservado, ocupado],
        });
        calendar.render(); // Renderiza o calendário no elemento especificado
        
    });
</script>
{% endblock %}